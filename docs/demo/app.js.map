{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/app.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","worker","Worker","addEventListener","e","_e$data$options","data","options","position","padding","shapeOutsidePolygon","baseImageStyleArr","push","baseImageStyle","join","pixelData","width","height","document","getElementById","style","display","result","setTimeout","scrollHeight","preview","innerHTML","img","createElement","src","forms","frm","elements","url","appendChild","span","debug","addCanvas","imageData","polygon","canvas","ctx","getContext","putImageData","fillStyle","strokeStyle","beginPath","moveTo","x","y","length","lineTo","closePath","fill","stroke","rawMaskData","paddedMaskData","rawContour","form","imageOptions","targetWidth","parseInt","callback","Image","crossOrigin","onload","scale","targetHeight","Math","round","drawImage","getImageData","useAlpha","test","postMessage","preventDefault"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/app.js\");\n","// TODO: use vue?\n// TODO: expose all options\n// TODO: make margin a %\nconst worker = new Worker('./worker.js');\n\nworker.addEventListener('message', (e) => {\n  const { position, padding } = e.data.options;\n  const { shapeOutsidePolygon } = e.data;\n  const baseImageStyleArr = [`float: ${position};`];\n  if (position === 'left') {\n    baseImageStyleArr.push(`margin-right: ${padding}px;`);\n  }\n  if (position === 'right') {\n    baseImageStyleArr.push(`margin-left: ${padding}px;`);\n  }\n  baseImageStyleArr.push(`margin-bottom: ${padding}px;`);\n  baseImageStyleArr.push(`shape-outside: polygon(${shapeOutsidePolygon});`);\n  const baseImageStyle = baseImageStyleArr.join('\\r\\n');\n\n  const { pixelData } = e.data;\n  const { width, height } = pixelData;\n  document.getElementById('output').style.display = 'block';\n\n  const result = document.getElementById('result');\n  result.value = baseImageStyle;\n  setTimeout(() => {\n    // autoresize on next tick\n    result.style.height = '5px';\n    result.style.height = `${result.scrollHeight}px`;\n  }, 0);\n\n  const preview = document.getElementById('preview');\n  preview.innerHTML = '';\n  const img = document.createElement('img');\n  img.src = document.forms.frm.elements.url.value;\n  img.width = width;\n  img.height = height;\n  img.style = `max-width: 25%; height: auto;${baseImageStyle}`;\n  preview.appendChild(img);\n  const span = document.createElement('span');\n  span.innerHTML = `\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam quis ante nulla. Etiam imperdiet, sapien non imperdiet hendrerit, ex nisl bibendum sapien, pulvinar blandit massa magna ut ipsum. Praesent a blandit velit. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Aenean tempus diam quis risus posuere lacinia. Mauris pellentesque quam sem, ut fermentum dolor sagittis vitae. Aenean elementum mauris at diam eleifend vehicula. Pellentesque non ipsum sagittis, vehicula erat sit amet, ultricies mi. Aliquam luctus vel sem maximus pretium. Ut suscipit consectetur sollicitudin. Maecenas commodo congue massa at vestibulum. Duis non lacinia sapien. Aliquam eu egestas massa. Duis et risus mauris. Vivamus id metus luctus, porttitor metus ac, interdum sapien.\n    <br><br>\n    Suspendisse tempus ante in mattis porta. Aenean placerat lacus quis volutpat suscipit. Suspendisse posuere justo non justo lacinia, non dignissim eros faucibus. Vestibulum sed convallis risus, et sollicitudin arcu. Donec eleifend ante est, vel tincidunt diam hendrerit vel. Integer nisl turpis, volutpat id viverra in, rhoncus nec dui. Integer eget tincidunt sapien. Cras sodales lacus eros, bibendum efficitur eros facilisis id. Aliquam ornare sem diam, vel commodo urna condimentum eget. Cras congue dapibus mauris, a dapibus felis aliquam id. Maecenas non ultrices urna. Ut sit amet neque consequat lorem rhoncus accumsan ac in arcu.`;\n  preview.appendChild(span);\n\n  const debug = document.getElementById('debug');\n  debug.innerHTML = '';\n  const addCanvas = (imageData, polygon) => {\n    const canvas = document.createElement('canvas');\n    canvas.width = imageData.width;\n    canvas.height = imageData.height;\n    const ctx = canvas.getContext('2d');\n    ctx.putImageData(imageData, 0, 0);\n    if (polygon) {\n      ctx.fillStyle = 'rgba(255,0,0,.3)';\n      ctx.strokeStyle = '#f00';\n      ctx.beginPath();\n      ctx.moveTo(polygon.x[0], polygon.y[0]);\n      for (let i = 1; i < polygon.length; i++) { ctx.lineTo(polygon.x[i], polygon.y[i]); }\n      ctx.closePath();\n      ctx.fill();\n      ctx.stroke();\n\n      ctx.strokeStyle = '#00f';\n      ctx.beginPath();\n      for (let i = 1; i < polygon.length - 1; i += 2) {\n        ctx.moveTo(polygon.x[i], polygon.y[i]);\n        ctx.lineTo(polygon.x[i + 1], polygon.y[i + 1]);\n      }\n      ctx.stroke();\n    }\n    debug.appendChild(canvas);\n  };\n  addCanvas(pixelData);\n  addCanvas(e.data.rawMaskData);\n  addCanvas(e.data.paddedMaskData);\n  addCanvas(e.data.rawMaskData, e.data.rawContour);\n  addCanvas(e.data.rawMaskData, e.data.polygon);\n});\n\nconst getImageData = (url, options, callback) => {\n  const canvas = document.createElement('canvas');\n  const img = new Image();\n  img.crossOrigin = 'Anonymous';\n  img.onload = () => {\n    let scale = 1;\n    if (options.targetWidth) {\n      scale = options.targetWidth / img.width;\n    } else if (options.targetHeight) {\n      scale = options.targetHeight / img.height;\n    }\n    canvas.width = Math.round(scale * img.width);\n    canvas.height = Math.round((canvas.width / img.width) * img.height);\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n    callback(ctx.getImageData(0, 0, canvas.width, canvas.height));\n  };\n  img.src = url;\n};\n\nconst form = document.forms.frm;\nform.addEventListener('submit', (e) => {\n  const url = form.elements.url.value;\n  const imageOptions = {\n    targetWidth: parseInt(form.elements.targetWidth.value, 10),\n  };\n  getImageData(url, imageOptions, (imageData) => {\n    const options = {\n      position: form.elements.position.value,\n      padding: imageData.width * (parseInt(form.elements.padding.value, 10) / 100),\n      useAlpha: /\\.(png|svg)$/.test(url),\n    };\n    worker.postMessage({\n      imageData,\n      options,\n    });\n  });\n  e.preventDefault();\n});\n"],"sourceRoot":""}